<html>
  <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="lib/pyodide.js"></script>
    <script type="text/javascript" src="lib/wavdecoder.js"></script>
    <script type="text/javascript" src="lib/Wav.js"></script>
    <script type="text/javascript" src="lib/AudioGenerator.js"></script>
    <script type="text/javascript">
      function bufferToWavBlob(audioBuffer) {
        let dataView = new DataView(audioBuffer);
        let blob = new Blob([dataView], {type: 'audio/wav'});
        return blob;
      }

      function blobToBuffer(wavBlob, callback) {
        let reader = new FileReader();
        reader.readAsArrayBuffer(wavBlob);
        reader.onload = function() {
          callback(reader.result);
        }
      }

      const screamAudioUrl = 'https://raw.githubusercontent.com/oampo/audiofile.js/master/example/audio/WilhelmScream.wav';
      const exampleAudioUrl = 'data/example.wav';
      
      // load Python language
      languagePluginLoader.then(() => {
        console.warn('Python initialized');
        let audioGen = new AudioGenerator();
        let specBtn = document.querySelector('#spec_btn');
        let mfccBtn = document.querySelector('#mfcc_btn');
        let resultBtn = document.querySelector('#result_btn');
        specBtn.onclick = function(evt) {
          let startTime = new Date().getTime();
          audioGen.spectrogramFromFile(exampleAudioUrl, 10, 20).then((spectrogram) => {
            let now = new Date().getTime();
            let elapsedTime = (now - startTime) / 1000;
            console.log(`Success!! finished in ${elapsedTime} seconds`);
            resultBtn.textContent = `Success!! finished in ${elapsedTime} seconds`;
          });
        }
        mfccBtn.onclick = function(evt) {
          // TODO mfcc extraction
        }
        
      });
    </script>
  </head>

  <body>
    <div id="vis" class="spectrogram"></div>
    <button id="spec_btn">Generate Spectrogram</button>
    <button id="mfcc_btn">Generate MFCC</button>
    <p style="width: 100%; white-space: pre-wrap;" id="result_btn"></p>
  </body>
</html>
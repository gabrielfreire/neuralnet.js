<!DOCTYPE html>
  <head>
    <link rel='stylesheet' href='style.css'>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="lib/pyodide.js"></script>
    <script type="text/javascript" src="lib/wavdecoder.js"></script>
    <script type="text/javascript" src="lib/Wav.js"></script>
    <script type="text/javascript" src="lib/AudioGenerator.js"></script>
  </head>
  
  <body>
    <h1>Generate Spectrogram or MFCC features from Audio files</h1>
    <p>Select the audio</p>
    <button id="opt1"><span xid='audioFile1'></span></button>
    <button id="opt2"><span xid='audioFile2'></span></button>
    <p>Current audio file: <span xid='audioFile'></span></p>
    <div class='loading'><p>Loading the Python language.<small> Please wait...</small></p></div>
    <div id="vis" class="spectrogram"></div>
    <button id="spec_btn">Generate Spectrogram</button>
    <button id="mfcc_btn">Generate MFCC [not implemented yet]</button>
    <p style="width: 100%; white-space: pre-wrap; font-size: 24px; font-weight: 700;" id="spec_result_btn"></p>
    <p style="width: 100%; white-space: pre-wrap; font-size: 24px; font-weight: 700;" id="mfcc_result_btn"></p>
    <script type="text/javascript" src="lib/ui.js"></script>
    <script>
      
      const _ui = ui();
      // load Python language
      _ui.showLoading();
      languagePluginLoader.then(() => {
        console.warn('Python initialized');
        let audioGen = new AudioGenerator(_ui);
        let specBtn = document.querySelector('#spec_btn');
        let mfccBtn = document.querySelector('#mfcc_btn');
        let specResultLabel = document.querySelector('#spec_result_btn');
        let mfccResultLabel = document.querySelector('#mfcc_result_btn');
        specBtn.onclick = function(evt) {
          let startTime = new Date().getTime();
          audioGen.spectrogramFromFile(_ui.currentAudio(), 10, 20).then((spectrogram) => {
            let now = new Date().getTime();
            let elapsedTime = (now - startTime) / 1000;
            console.log(`Success!! Generated Spectrogram in ${elapsedTime} seconds`);
            specResultLabel.textContent = `Success!! Generated Spectrogram in ${elapsedTime} seconds`;
          });
        }
        mfccBtn.onclick = function(evt) {
          // TODO mfcc extraction
          let startTime = new Date().getTime();
          audioGen.mfccFromFile(_ui.currentAudio()).then((mfcc) => {
            let now = new Date().getTime();
            let elapsedTime = (now - startTime) / 1000;
            console.log(`Success!! Generated MFCC in ${elapsedTime} seconds`);
            mfccResultLabel.textContent = `Success!! Generated MFCC in ${elapsedTime} seconds`;
          });
        }
        
      });
    </script>
  </body>
</html>